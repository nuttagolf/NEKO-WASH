<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEKO WASH</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body::before {
      content: "";
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background-image: url("my-logo.png");
      background-repeat: repeat;
      background-size:200px;
      opacity:0.05;
      z-index:-1;
    }
  </style>
</head>
<body class="bg-[#c3edfe] min-h-screen">
  <div id="root"></div>

<script type="text/babel">
const COLORS = { primary: "#213f9a", accent: "#c3edfe" };

const SERVICES = [
  { id: "wash16", title: "บริการซัก - ถังขนาด 16 กก.", options: [{id:"w16_hot",name:"ซักผ้า น้ำร้อน",price:70},{id:"w16_warm",name:"ซักผ้า น้ำอุ่น",price:60},{id:"w16_cold",name:"ซักผ้า น้ำเย็น",price:50}]},
  { id: "wash21", title: "บริการซัก - ถังขนาด 21 กก.", options: [{id:"w21_hot",name:"ซักผ้า น้ำร้อน",price:80},{id:"w21_warm",name:"ซักผ้า น้ำอุ่น",price:70},{id:"w21_cold",name:"ซักผ้า น้ำเย็น",price:60}]},
  { id: "dry10", title: "บริการอบ - ขนาด 10 กก.", options: [{id:"d10_high",name:"อบ อุณหภูมิสูง",price:60},{id:"d10_med",name:"อบ อุณหภูมิปานกลาง",price:50},{id:"d10_low",name:"อบ อุณหภูมิต่ำ",price:40}]},
  { id: "dry16", title: "บริการอบ - ขนาด 16 กก.", options: [{id:"d16_high",name:"อบ อุณหภูมิสูง",price:70},{id:"d16_med",name:"อบ อุณหภูมิปานกลาง",price:60},{id:"d16_low",name:"อบ อุณหภูมิต่ำ",price:50}]},
];

const DELIVERY = [
  { id:"pickup_drop", name:"รับ-ส่งผ้า (ร้านไปรับและส่งผ้า)", price:70 },
  { id:"self_drop", name:"ลูกค้านำผ้ามาส่งที่ร้านด้วยตัวเอง", price:50 }
];

function App() {
  const [step,setStep] = React.useState("select");
  const [selected,setSelected] = React.useState({});
  const [deliveryChoice,setDeliveryChoice] = React.useState("pickup_drop");

  const chosenItems = React.useMemo(()=>{
    const items = [];
    SERVICES.forEach(group=>{
      const selIds = selected[group.id] || [];
      selIds.forEach(id=>{
        const opt = group.options.find(o=>o.id===id);
        if(opt) items.push({id:opt.id,name:`${opt.name} (${group.title.replace("บริการ","")})`,price:opt.price});
      });
    });
    const deliveryOpt = DELIVERY.find(d=>d.id===deliveryChoice);
    if(deliveryOpt) items.push({id:deliveryOpt.id,name:deliveryOpt.name,price:deliveryOpt.price});
    return items;
  },[selected,deliveryChoice]);

  const total = React.useMemo(()=>chosenItems.reduce((s,i)=>s+i.price,0),[chosenItems]);

  const handleSelect = (groupId, optionId)=>{
    const current = selected[groupId] || [];
    if(current.includes(optionId)){
      setSelected(prev=>({...prev,[groupId]:current.filter(i=>i!==optionId)}));
    } else {
      setSelected(prev=>({...prev,[groupId]:[...current,optionId]}));
    }
  };

  return (
    <div className="min-h-screen">
      <Header />
      <div className="max-w-3xl mx-auto p-4 sm:p-6">
        <div className="bg-white rounded-3xl shadow-xl p-6 sm:p-8">
          {step==="select" && <SelectServices 
            selected={selected} 
            onSelect={handleSelect} 
            total={total} 
            onConfirm={()=>setStep("review")}
            deliveryChoice={deliveryChoice}
            setDeliveryChoice={setDeliveryChoice}
          />}
          {step==="review" && <Review items={chosenItems} total={total} onBack={()=>setStep("select")} onConfirm={()=>setStep("pay")} />}
          {step==="pay" && <Payment items={chosenItems} total={total} onBack={()=>setStep("review")} onPaid={()=>setStep("success")} />}
          {step==="success" && <Success total={total} onNewOrder={()=>{setSelected({}); setStep("select"); setDeliveryChoice("pickup_drop");}} />}
        </div>
      </div>
    </div>
  );
}

function Header(){
  return (
    <header className="w-full py-6" style={{background:COLORS.primary}}>
      <div className="max-w-3xl mx-auto px-6 flex items-center gap-4">
        <img src="my-logo.png" alt="โลโก้ร้าน NEKO WASH" className="w-20 sm:w-24"/>
        <div>
          <h1 className="text-2xl sm:text-3xl font-bold text-white tracking-wide">NEKO WASH - บริการฝากซักอบผ้า</h1>
          <p className="text-white/90 mt-1">เมนูการให้บริการ - NEKO WASH MUKDAHAN</p>
        </div>
      </div>
    </header>
  );
}

function SelectServices({selected,onSelect,onConfirm,total,deliveryChoice,setDeliveryChoice}){
  return (
    <div>
      <h2 className="text-xl sm:text-2xl font-semibold text-gray-900 mb-4">ตัวเลือกการบริการ</h2>
      <div className="space-y-4">
        {SERVICES.map(group=>(
          <div key={group.id} className="rounded-2xl border border-gray-100 shadow-sm p-4 sm:p-5">
            <h3 className="font-semibold text-gray-800 mb-3">{group.title}</h3>
            <div className="grid sm:grid-cols-2 gap-3">
              {group.options.map(opt=>{
                const isSelected = selected[group.id]?.includes(opt.id);
                return (
                  <label key={opt.id} className={`flex items-center justify-between gap-3 rounded-2xl border px-4 py-3 cursor-pointer transition-shadow ${isSelected?"border-transparent shadow-md":"border-gray-200 hover:shadow-sm"}`} style={{background:isSelected?COLORS.accent:"#fff"}}>
                    <div className="flex items-center gap-3">
                      <input type="checkbox" className="h-5 w-5 rounded-md border-gray-300" checked={isSelected||false} onChange={()=>onSelect(group.id,opt.id)} />
                      <span className="text-gray-800">{opt.name}</span>
                    </div>
                    <span className="font-semibold text-gray-900">{opt.price} บาท</span>
                  </label>
                );
              })}
            </div>
          </div>
        ))}

        <div className="rounded-2xl border border-gray-100 bg-gray-50 p-4">
          <div className="mb-2 text-gray-700 font-medium">ตัวเลือกจัดส่ง</div>
          <div className="flex gap-3 flex-wrap">
            {DELIVERY.map(d=>(
              <label key={d.id} className={`flex-1 rounded-2xl border px-4 py-3 cursor-pointer text-center transition-shadow ${deliveryChoice===d.id?"border-transparent shadow-md":"border-gray-200 hover:shadow-sm"}`} style={{background:deliveryChoice===d.id?COLORS.accent:"#fff"}}>
                <input type="radio" name="delivery" className="hidden" checked={deliveryChoice===d.id} onChange={()=>setDeliveryChoice(d.id)} />
                <div className="font-semibold text-gray-900">{d.name}</div>
                <div className="text-gray-800">{d.price} บาท</div>
              </label>
            ))}
          </div>
          <p className="text-xs text-gray-500 mt-1">* เลือกรูปแบบการบริการ</p>
        </div>
      </div>
      <div className="flex items-center justify-between mt-6">
        <div className="text-lg font-semibold">รวมทั้งหมด: <span className="text-gray-900">{total}</span> บาท</div>
        <Button onClick={onConfirm}>ยืนยันการเลือก</Button>
      </div>
    </div>
  );
}

function Review({items,total,onBack,onConfirm}) {
  const [selectedQty, setSelectedQty] = React.useState(() => {
    const init = {};
    items.forEach(it => {
      if(!it.id.startsWith("pickup") && !it.id.startsWith("self")) init[it.id] = 1;
      else init[it.id] = 1; // ส่งค่าคงที่สำหรับบริการจัดส่ง
    });
    return init;
  });

  const updateQty = (id, value) => {
    const v = Math.max(1, Math.min(99, Number(value)));
    setSelectedQty(prev => ({ ...prev, [id]: v }));
  };

  const totalPrice = items.reduce((sum, it) => sum + it.price * selectedQty[it.id], 0);

  const downloadReceipt = () => {
    const receiptEl = document.getElementById("receipt");
    if(!receiptEl) return;
    html2canvas(receiptEl,{backgroundColor:"#fff",scale:2}).then(canvas=>{
      canvas.toBlob(function(blob){
        const link=document.createElement("a");
        link.href=URL.createObjectURL(blob);
        link.download=`receipt_${Date.now()}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      },"image/png");
    });
  };

  return (
    <div>
      <h2 className="text-xl sm:text-2xl font-semibold text-gray-900 mb-4">สรุปรายการบริการที่เลือก</h2>
      <div id="receipt">
        <ul className="divide-y divide-gray-100 rounded-2xl border border-gray-100 overflow-hidden">
          {items.map(it => (
            <li key={it.id} className="flex items-center justify-between px-4 py-3 bg-white gap-2">
              <span className="text-gray-800 flex-1">{it.name}</span>
              {!it.id.startsWith("pickup") && !it.id.startsWith("self") && (
                <input 
                  type="number" 
                  min="1" 
                  max="99" 
                  value={selectedQty[it.id]} 
                  onChange={(e)=>updateQty(it.id, e.target.value)}
                  className="w-16 px-2 py-1 border rounded text-center"
                />
              )}
              <span className="font-semibold text-gray-900">{it.price * selectedQty[it.id]} บาท</span>
            </li>
          ))}
          <li className="flex items-center justify-between px-4 py-4 bg-gray-50 font-semibold">
            <span>รวม</span>
            <span className="text-gray-900">{totalPrice} บาท</span>
          </li>
        </ul>
      </div>

      <div className="flex flex-col md:flex-row md:flex-wrap gap-3 mt-4">
        <Button variant="ghost" onClick={onBack} className="flex-1 md:flex-auto">ย้อนกลับไปแก้ไข</Button>
        <Button onClick={onConfirm} className="flex-1 md:flex-auto">ยืนยันและไปชำระเงิน</Button>
        <button onClick={downloadReceipt} className="rounded-full px-6 py-3 bg-green-600 text-white font-medium shadow hover:shadow-md flex-1 md:flex-auto">ดาวน์โหลดบิล</button>
      </div>
    </div>
  );
}

function Payment({items,total,onBack,onPaid}){
  const qrFile="my-qr.jpg";
  const [secondsLeft,setSecondsLeft] = React.useState(15*60);
  const [expired,setExpired] = React.useState(false);

  React.useEffect(()=>{
    if(expired) return;
    const interval = setInterval(()=>{
      setSecondsLeft(prev=>{
        if(prev<=1){ clearInterval(interval); setExpired(true); return 0;}
        return prev-1;
      });
    },1000);
    return ()=>clearInterval(interval);
  },[expired]);

  const formatTime = sec => {
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  };

  return (
    <div>
      <h2 className="text-xl sm:text-2xl font-semibold text-gray-900 mb-4">ชำระเงิน</h2>
      {!expired ? (
        <div className="text-center bg-white rounded-3xl border border-gray-100 p-6">
          <p className="text-gray-700 mb-2">เวลาที่เหลือ: {formatTime(secondsLeft)}</p>
          <img src={qrFile} alt="QR Code" className="mx-auto rounded-2xl border-4 mb-4" style={{borderColor:COLORS.accent}} />
          <p className="mt-2 text-gray-700">สแกนเพื่อชำระเงิน</p>
          <p className="mt-1 font-medium text-gray-800">เมื่อโอนเสร็จเรียบร้อยแล้ว รบกวนแจ้งหลักฐานการโอนผ่านแชทไลน์</p>
        </div>
      ) : (
        <div className="text-center bg-white rounded-3xl border border-gray-100 p-6">
          <p className="text-red-600 font-semibold text-lg">ชำระไม่สำเร็จ</p>
          <Button onClick={onBack}>ทำรายการใหม่</Button>
        </div>
      )}
      {!expired && <div className="flex gap-3 mt-6">
        <Button variant="ghost" onClick={onBack}>ย้อนกลับ</Button>
        <Button onClick={onPaid}>ฉันได้ชำระเงินแล้ว</Button>
      </div>}
    </div>
  );
}

function Success({total,onNewOrder}){
  return (
    <div className="text-center">
      <div className="bg-white rounded-3xl border border-gray-100 p-8">
        <div className="mx-auto mb-4 h-14 w-14 rounded-full flex items-center justify-center" style={{background:COLORS.accent}}>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={COLORS.primary} className="h-8 w-8">
            <path fillRule="evenodd" d="M2.25 12C2.25 6.615 6.615 2.25 12 2.25S21.75 6.615 21.75 12 17.385 21.75 12 21.75 2.25 17.385 2.25 12zm13.36-2.56a.75.75 0 10-1.22-.88l-3.6 5a.75.75 0 01-1.13.1l-1.7-1.7a.75.75 0 10-1.06 1.06l2.1 2.1a1.75 1.75 0 002.64-.23l3.97-5.45z" clipRule="evenodd" />
          </svg>
        </div>
        <h3 className="text-2xl font-bold text-gray-900 mb-1">ชำระเงินสำเร็จ</h3>
        <p className="text-gray-700">ขอบคุณที่ใช้บริการ NEKO WASH</p>
        <p className="text-gray-700 mt-2">ยอดรวม {total} บาท</p>
      </div>
      <Button className="mt-6" onClick={onNewOrder}>สั่งบริการใหม่อีกครั้ง</Button>
    </div>
  );
}

function Button({children,onClick,variant="primary",className=""}){
  if(variant==="ghost"){
    return <button onClick={onClick} className={`rounded-full px-6 py-3 border transition shadow-sm hover:shadow ${className}`} style={{borderColor:COLORS.primary,color:COLORS.primary,background:"#fff"}}>{children}</button>;
  }
  return <button onClick={onClick} className={`rounded-full px-6 py-3 font-medium transition shadow hover:shadow-md ${className}`} style={{background:COLORS.primary,color:"#fff"}}>{children}</button>;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
